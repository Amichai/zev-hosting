<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>yakawow</title>
    <style>
        /* --- CSS: Main Styling --- */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f9;
        }

        h2 {
            color: #333;
            text-transform: uppercase;
            letter-spacing: 2px;
            display: inline-block;
        }

        /* Top Right Login Button */
        .top-right-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 10px 20px;
            background-color: #333;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            font-weight: bold;
        }

        .top-right-btn:hover {
            background-color: #d32f2f;
        }

        /* Tab Container */
        .tab {
            overflow: hidden;
            border: 1px solid #ccc;
            background-color: #333;
            border-radius: 5px 5px 0 0;
            margin-top: 20px;
        }

        /* Tab Buttons */
        .tab button {
            background-color: inherit;
            float: left;
            border: none;
            outline: none;
            cursor: pointer;
            padding: 14px 16px;
            transition: 0.3s;
            font-size: 17px;
            color: white;
            font-weight: bold;
        }

        .tab button:hover {
            background-color: #555;
        }

        .tab button.active {
            background-color: #d32f2f;
        }

        #adminTabBtn {
            display: none;
            background-color: #444;
            color: #ff9800;
        }

        /* Tab Content */
        .tabcontent {
            display: none;
            padding: 20px;
            border: 1px solid #ccc;
            border-top: none;
            background-color: white;
            min-height: 600px;
            border-radius: 0 0 5px 5px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        /* --- LIBRARY GRID --- */
        .library-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 20px;
            padding: 20px 0;
        }

        .game-card {
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
        }

        .game-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            background-color: #fff;
            border-color: #d32f2f;
        }

        .game-icon {
            font-size: 40px;
            margin-bottom: 10px;
            display: block;
        }

        .game-title {
            font-weight: bold;
            color: #333;
            word-break: break-word;
        }

        /* --- ANNOUNCEMENTS --- */
        .announcement-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 30px;
            padding: 10px;
            background-color: #fff8e1;
            /* Light background for section */
            border-radius: 8px;
        }

        .announcement-card {
            background-color: #fff;
            border: 1px solid #ffeeba;
            border-left: 5px solid #ffc107;
            /* Yellow stripe */
            padding: 15px;
            border-radius: 4px;
            position: relative;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .announcement-title {
            font-weight: bold;
            font-size: 18px;
            margin-bottom: 8px;
            display: block;
            color: #d32f2f;
        }

        .announcement-text {
            color: #333;
            white-space: pre-wrap;
            /* Keeps paragraphs/lines */
            font-size: 14px;
            line-height: 1.5;
        }

        /* --- CARD BUTTONS --- */
        .delete-card-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: red;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 2px 6px;
            font-size: 12px;
            cursor: pointer;
            z-index: 10;
        }

        .delete-card-btn:hover {
            background-color: darkred;
        }

        .export-card-btn {
            position: absolute;
            top: 5px;
            left: 5px;
            background: #2196F3;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 2px 6px;
            font-size: 12px;
            cursor: pointer;
            z-index: 10;
        }

        .export-card-btn:hover {
            background-color: #0b7dda;
        }

        /* --- PLAYER OVERLAY --- */
        .player-container {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: black;
            z-index: 1000;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-sizing: border-box;
        }

        .back-btn {
            position: absolute;
            top: 15px;
            left: 15px;
            background-color: rgba(211, 47, 47, 0.8);
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            z-index: 1001;
        }

        .back-btn:hover {
            background-color: #ff5252;
        }

        #ActiveGameTitle,
        #ActiveAppTitle {
            display: none;
        }

        .iframe-wrapper {
            width: 95vw;
            height: 95vh;
            background: transparent;
            border: none;
            box-shadow: none;
        }

        .game-frame {
            width: 100%;
            height: 100%;
            border: none;
            display: block;
        }

        /* --- SHARE MODAL --- */
        .share-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .share-box {
            background: white;
            padding: 20px;
            border-radius: 10px;
            width: 400px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
        }

        .share-textarea {
            width: 100%;
            height: 100px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            padding: 5px;
            border: 1px solid #ccc;
            background-color: #eee;
            color: #555;
            resize: none;
        }

        .copy-btn {
            background-color: #4CAF50;
            /* Green */
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin-right: 10px;
        }

        .copy-btn:hover {
            background-color: #3e8e41;
        }

        .close-share-btn {
            background-color: #777;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }

        .close-share-btn:hover {
            background-color: #555;
        }


        /* --- Admin Styling --- */
        .admin-controls {
            background-color: #f0f0f0;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #ddd;
        }

        input[type="text"],
        textarea,
        select {
            width: 100%;
            padding: 10px;
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-radius: 4px;
            margin-bottom: 10px;
        }

        textarea {
            height: 150px;
            font-family: monospace;
        }

        .action-btn {
            background-color: #4CAF50;
            color: white;
            padding: 10px;
            border: none;
            cursor: pointer;
            font-weight: bold;
            border-radius: 4px;
            width: 100%;
            margin-bottom: 10px;
        }

        .export-btn {
            background-color: #2196F3;
            /* Blue */
            color: white;
            padding: 10px;
            border: none;
            cursor: pointer;
            font-weight: bold;
            border-radius: 4px;
            width: 100%;
            margin-bottom: 10px;
        }

        .danger-btn {
            background-color: #d32f2f;
            color: white;
            padding: 10px;
            border: none;
            cursor: pointer;
            border-radius: 4px;
            width: 100%;
        }

        /* Home Import Button */
        .import-btn-large {
            display: inline-block;
            background-color: #673AB7;
            /* Purple */
            color: white;
            padding: 15px 30px;
            font-size: 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 20px;
            font-weight: bold;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .import-btn-large:hover {
            background-color: #512da8;
        }
    </style>
</head>

<body>

    <h2>yakawow</h2>

    <button class="top-right-btn" onclick="attemptLogin()">üîí Login</button>

    <div class="tab">
        <button class="tablinks" onclick="openTab(event, 'Home')" id="defaultOpen">Home</button>
        <button class="tablinks" onclick="openTab(event, 'Apps')">Apps</button>
        <button class="tablinks" onclick="openTab(event, 'Games')">Games</button>
        <button class="tablinks" onclick="openTab(event, 'Admin')" id="adminTabBtn">Admin</button>
    </div>

    <div id="Home" class="tabcontent">
        <h3>Home</h3>
        <p>Welcome to <strong>yakawow</strong>.</p>

        <h4 style="border-bottom: 2px solid #ddd; padding-bottom: 10px;">üì¢ Announcements</h4>
        <div id="AnnouncementsLibrary" class="announcement-container">
            <p style="color: #666; font-style: italic;">No announcements yet.</p>
        </div>

        <hr style="border: 0; border-top: 1px solid #ccc; margin: 30px 0;">

        <p>To add a new game from a friend, click the button below and paste the code.</p>
        <button class="import-btn-large" onclick="importFromCode()">üì• Import Code</button>
    </div>

    <div id="Apps" class="tabcontent">
        <h3>Apps</h3>
        <div id="AppsLibrary" class="library-grid"></div>
        <div id="AppsPlayer" class="player-container">
            <button class="back-btn" onclick="closeItem('Apps')">‚ùå CLOSE</button>
            <h2 id="ActiveAppTitle"></h2>
            <div id="AppsFrameContainer" class="iframe-wrapper"></div>
        </div>
    </div>

    <div id="Games" class="tabcontent">
        <h3>Games</h3>
        <div id="GamesLibrary" class="library-grid"></div>
        <div id="GamesPlayer" class="player-container">
            <button class="back-btn" onclick="closeItem('Games')">‚ùå CLOSE</button>
            <h2 id="ActiveGameTitle"></h2>
            <div id="GamesFrameContainer" class="iframe-wrapper"></div>
        </div>
    </div>

    <div id="Admin" class="tabcontent">
        <h3 style="color: red;">ADMIN CONTROL PANEL</h3>
        <p>Create a game, app, or announcement.</p>

        <div class="admin-controls">
            <label><strong>1. Name / Title:</strong></label>
            <input type="text" id="itemTitle" placeholder="e.g. Update v1.0">

            <label><strong>2. Type:</strong></label>
            <select id="itemCategory" onchange="updatePlaceholder()">
                <option value="Games">Game</option>
                <option value="Apps">App</option>
                <option value="Announcements">Announcement</option>
            </select>

            <label><strong>3. Code / Message:</strong></label>
            <textarea id="itemCode" placeholder="<html>... your code here ...</html>"></textarea>

            <button class="action-btn" onclick="addToLibrary()">üíæ Save</button>
            <button class="export-btn" onclick="exportCurrentInput()">üì§ Open Export Menu</button>
            <br><br>
            <button class="danger-btn" onclick="clearAllData()">‚ö†Ô∏è Delete ALL Data</button>
        </div>
    </div>

    <div id="ShareModal" class="share-modal">
        <div class="share-box">
            <h3>Share Code</h3>
            <p>Click Copy, then send this code to a friend!</p>
            <textarea id="shareOutput" class="share-textarea" readonly></textarea>
            <br>
            <button class="copy-btn" onclick="copyShareCode()">üìã COPY</button>
            <button class="close-share-btn" onclick="closeShareModal()">Close</button>
        </div>
    </div>

    <script>
        // --- DATA STORAGE & MIGRATION ---

        // 1. Check for OLD data (yakattack)
        var oldDataString = localStorage.getItem("yakattackData");
        var newDataString = localStorage.getItem("yakawowData");

        // 2. Auto-Migrate if old exists but new does not
        if (oldDataString && !newDataString) {
            console.log("Migrating data from 'yakattackData' to 'yakawowData'...");
            localStorage.setItem("yakawowData", oldDataString);
            newDataString = oldDataString; // Update reference for below
            alert("Success! Your old games/apps have been moved to yakawow.");
        }

        // 3. Load Data
        var libraryData;
        try {
            libraryData = newDataString ? JSON.parse(newDataString) : { "Games": [], "Apps": [], "Announcements": [] };
        } catch (e) {
            libraryData = { "Games": [], "Apps": [], "Announcements": [] };
        }

        // AUTO-FIX: Ensure Announcements array exists if user has old data
        if (!libraryData.Announcements) {
            libraryData.Announcements = [];
            localStorage.setItem("yakawowData", JSON.stringify(libraryData));
        }

        var isAdmin = false;

        function saveToBrowser() {
            localStorage.setItem("yakawowData", JSON.stringify(libraryData));
        }

        // --- TAB LOGIC ---
        function openTab(evt, tabName) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) { tabcontent[i].style.display = "none"; }
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) { tablinks[i].className = tablinks[i].className.replace(" active", ""); }
            document.getElementById(tabName).style.display = "block";
            if (evt) evt.currentTarget.className += " active";
        }

        // --- LOGIN LOGIC ---
        function attemptLogin() {
            var password = prompt("Enter Admin Password:");
            if (password === "deathtrap") {
                alert("Access Granted. Edit mode enabled.");
                isAdmin = true;
                document.getElementById("adminTabBtn").style.display = "block";
                document.getElementById("adminTabBtn").click();

                // Refresh all
                renderLibrary("Games");
                renderLibrary("Apps");
                renderLibrary("Announcements");
            } else if (password != null) {
                alert("Access Denied.");
            }
        }

        // --- HELPER: Placeholder Text ---
        function updatePlaceholder() {
            var cat = document.getElementById("itemCategory").value;
            var textArea = document.getElementById("itemCode");
            if (cat === "Announcements") {
                textArea.placeholder = "Type your news message here...";
            } else {
                textArea.placeholder = "<html>... your game/app code here ...</html>";
            }
        }

        // --- LIBRARY LOGIC ---
        function addToLibrary() {
            var title = document.getElementById("itemTitle").value;
            var category = document.getElementById("itemCategory").value;
            var code = document.getElementById("itemCode").value;

            if (title.trim() === "" || code.trim() === "") {
                alert("Please fill in a Title and Code/Message.");
                return;
            }

            var newItem = { id: Date.now(), title: title, code: code };

            // Safety check
            if (!libraryData[category]) libraryData[category] = [];

            libraryData[category].push(newItem);
            saveToBrowser();
            renderLibrary(category);

            alert(title + " Saved!");
            document.getElementById("itemTitle").value = "";
            document.getElementById("itemCode").value = "";
        }

        function renderLibrary(category) {
            var container = document.getElementById(category + "Library");
            if (!container) return; // Safety check

            container.innerHTML = "";
            var items = libraryData[category];

            if (!items || items.length === 0) {
                if (category === "Announcements") {
                    container.innerHTML = "<p style='color:#666; font-style:italic;'>No announcements yet.</p>";
                } else {
                    container.innerHTML = "<p>No items found.</p>";
                }
                return;
            }

            // Iterate backwards (Newest First)
            for (let i = items.length - 1; i >= 0; i--) {
                let item = items[i];
                var card = document.createElement("div");

                var deleteBtnHTML = "";
                var exportBtnHTML = "";

                if (isAdmin) {
                    deleteBtnHTML = `<button class="delete-card-btn" onclick="deleteItem(event, '${category}', ${item.id})">Del</button>`;
                    exportBtnHTML = `<button class="export-card-btn" onclick="exportItem(event, '${category}', ${item.id})">Share</button>`;
                }

                if (category === "Announcements") {
                    // --- ANNOUNCEMENT STYLE ---
                    card.className = "announcement-card";
                    // Using innerText for the body prevents HTML injection in news, safer for text
                    card.innerHTML = `
                        ${deleteBtnHTML}
                        ${exportBtnHTML}
                        <span class="announcement-title"></span>
                        <div class="announcement-text"></div> 
                    `;
                    // Set text safely
                    card.querySelector(".announcement-title").innerText = item.title;
                    card.querySelector(".announcement-text").innerText = item.code;

                } else {
                    // --- GAME/APP STYLE ---
                    card.className = "game-card";
                    var icon = category === "Games" ? "üéÆ" : "üì±";

                    card.innerHTML = `
                        ${deleteBtnHTML}
                        ${exportBtnHTML}
                        <span class="game-icon">${icon}</span>
                        <span class="game-title"></span>
                    `;
                    card.querySelector(".game-title").innerText = item.title;

                    card.onclick = function (e) {
                        if (e.target.className !== 'delete-card-btn' && e.target.className !== 'export-card-btn') {
                            playItem(category, item.id);
                        }
                    };
                }
                container.appendChild(card);
            }
        }

        function playItem(category, id) {
            if (category === "Announcements") return;

            var items = libraryData[category];
            var selectedItem = items.find(item => item.id === id);
            if (!selectedItem) return;

            var player = document.getElementById(category + "Player");
            player.style.display = "flex";

            var titleId = category === "Games" ? "ActiveGameTitle" : "ActiveAppTitle";
            document.getElementById(titleId).innerText = selectedItem.title;

            document.body.style.overflow = "hidden";

            var container = document.getElementById(category + "FrameContainer");
            container.innerHTML = "";

            var iframe = document.createElement('iframe');
            iframe.className = "game-frame";
            iframe.onload = function () { iframe.focus(); };
            container.appendChild(iframe);

            var doc = iframe.contentWindow.document;
            doc.open();
            doc.write(selectedItem.code);
            doc.close();
        }

        function closeItem(category) {
            document.getElementById(category + "FrameContainer").innerHTML = "";
            document.getElementById(category + "Player").style.display = "none";
            document.body.style.overflow = "auto";
        }

        function deleteItem(event, category, id) {
            event.stopPropagation();
            if (confirm("Delete this item?")) {
                libraryData[category] = libraryData[category].filter(item => item.id !== id);
                saveToBrowser();
                renderLibrary(category);
            }
        }

        function clearAllData() {
            if (confirm("ARE YOU SURE? This will delete ALL games and apps forever.")) {
                localStorage.removeItem("yakawowData");
                // Optional: Also clear the old backup
                // localStorage.removeItem("yakattackData"); 
                location.reload();
            }
        }

        // --- SHARE MENU LOGIC ---
        function exportCurrentInput() {
            var title = document.getElementById("itemTitle").value;
            var category = document.getElementById("itemCategory").value;
            var code = document.getElementById("itemCode").value;

            if (title.trim() === "" || code.trim() === "") {
                alert("Please fill in Title and Content before exporting.");
                return;
            }
            prepareShareModal(title, category, code);
        }

        function exportItem(event, category, id) {
            event.stopPropagation();
            var items = libraryData[category];
            var item = items.find(i => i.id === id);

            if (item) {
                prepareShareModal(item.title, category, item.code);
            }
        }

        function prepareShareModal(title, category, code) {
            var dataObj = { title: title, category: category, code: code };
            var jsonString = JSON.stringify(dataObj);
            var encodedString = btoa(encodeURIComponent(jsonString));

            document.getElementById("shareOutput").value = encodedString;
            document.getElementById("ShareModal").style.display = "flex";
        }

        function copyShareCode() {
            var copyText = document.getElementById("shareOutput");
            copyText.select();
            copyText.setSelectionRange(0, 99999);
            navigator.clipboard.writeText(copyText.value).then(function () {
                alert("‚úÖ Code Copied! Send it to a friend.");
                closeShareModal();
            }, function () {
                alert("Failed to copy. Please copy manually.");
            });
        }

        function closeShareModal() {
            document.getElementById("ShareModal").style.display = "none";
        }

        // --- IMPORT LOGIC ---
        function importFromCode() {
            var pastedCode = prompt("Paste your Game/App/News Code here:");

            if (pastedCode == null || pastedCode.trim() == "") return;

            try {
                var jsonString = decodeURIComponent(atob(pastedCode));
                var dataObj = JSON.parse(jsonString);

                if (!dataObj.title || !dataObj.category || !dataObj.code) {
                    throw new Error("Invalid Code Format");
                }

                // Auto-fix if category missing
                if (!libraryData[dataObj.category]) {
                    libraryData[dataObj.category] = [];
                }

                var newItem = {
                    id: Date.now(),
                    title: dataObj.title,
                    code: dataObj.code
                };

                libraryData[dataObj.category].push(newItem);
                saveToBrowser();

                // Refresh ALL
                renderLibrary("Games");
                renderLibrary("Apps");
                renderLibrary("Announcements");

                alert("Successfully imported: " + dataObj.title);

            } catch (err) {
                alert("Error: That code didn't work. Make sure you copied the whole thing!");
                console.error(err);
            }
        }

        // Initialize
        document.getElementById("defaultOpen").click();
        renderLibrary("Games");
        renderLibrary("Apps");
        renderLibrary("Announcements");
    </script>

</body>

</html>